<table><tr><td><p>Docx html Editor</p></td></tr><tr><td><p><strong>v0.0.1 Proof of Concept User Manual</strong></p></td></tr></table><p><img src="data:image/jpeg;base64,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" alt="http://www.plutext.com/PlutextLogoText160.jpg" /></p><table><tr><td></td></tr></table><table><tr><td></td></tr></table><p>Contents</p><p><a href="#_Toc371058483">SOLUTION OVERVIEW	3</a></p><p><a href="#_Toc371058484">CONTENTS	4</a></p><p><a href="#_Toc371058485">INSTALLATION	4</a></p><p><a href="#_Toc371058486">API	4</a></p><p><a href="#_Toc371058487">INTEGRATION	5</a></p><p><a href="#_Toc371058488">JAX-RS	5</a></p><p><a href="#_Toc371058489">LOGGING	5</a></p><p><a href="#_Toc371058490">DEPLOYMENT NOTES	6</a></p><p><a href="#_Toc371058491">KNOWN ISSUES/LIMITATIONS	6</a></p><p><a href="#_Toc371058492">ROADMAP	6</a></p><p><a href="#_Toc371058493">SUPPORT	6</a></p><p><a href="#_Toc371058494">Appendix 1 – LOAD REQUEST/RESPONSE	7</a></p><p><a href="#_Toc371058495">Appendix 2 – SAVE REQUEST/RESPONSE	8</a></p><p>Docx Html Editor</p><p>This document explains how to use the docx Html Editor</p><p>docx html Editor is a <strong><em>proof of concept</em></strong> of a new approach to editing docx documents in a web browser.</p><p>The objectives are two fold:</p><ul><li>to be able to utilize/integrate with customer’s preferred HTML editor to provide the user interface</li><li>after editing, to save a docx which preserves “long tail” content (eg charts, equations) which the editor was unable to manipulate</li></ul><p>In this proof of concept, the editor used is CKEditor 3.6.6.1</p><h1><a id="_Toc371058483"></a>SOLUTION OVERVIEW</h1><p>The docx file format contains a “long-tail” of features.  The web editor is designed to enable in browser editing of:</p><ul><li>Paragraphs of text (including basic formatting such a bold, italics, font size)</li><li>Images (insertion thereof)</li><li>Simple tables</li></ul><p>The solution handles most long tail features in one of two ways:</p><ol><li>By showing it in the XHTML as a “non-editable content” icon, then reinstating wholly or substantially the original feature when the XHTML is converted back to docx format, or</li><li>stripping/filtering/resolving that feature/content during the conversion to XHTML (with the result that this content will be missing from the docx created as a result of the editing process).   </li></ol><p>By way of illustration, the following table sets out how various features are treated:</p><table><tr><td><p>Feature</p></td><td><p>Stripped/<br />filtered</p></td><td><p>Reinstated</p></td></tr><tr><td><p>Shape</p></td><td></td><td></td></tr><tr><td><p>Chart</p></td><td></td><td></td></tr><tr><td><p>WordArt</p></td><td></td><td></td></tr><tr><td><p>ActiveX Control: Option button</p></td><td></td><td></td></tr><tr><td><p>Field</p></td><td></td><td></td></tr><tr><td><p>Signature line</p></td><td></td><td></td></tr><tr><td><p>Content control</p></td><td><p><em>some</em></p></td><td><p><strong><em>some</em></strong></p></td></tr></table><p>Basic workflow:</p><ol><li>Submit (POST) a docx to the server (specified URL)</li><li>Server-side, convert the docx file to (X)HTML </li><li>Stream the (X)HTML to the client device invoking web editor (ie CKEditor), with a WYSIWYG-like view of the (X)HTML, ready for editing</li><li>Once the user has made their edits, they can click a submit button, whereupon the (X)HTML document is posted to the server</li><li>The server converts the XHTML back to docx format</li><li>The server streams the docx back to client</li></ol><h1><a id="_Toc371058485"></a>INSTALLATION</h1><p>Install the WAR file in your application server following the procedure specified by its vendor.</p><p>After that, visit upload.html, for example:</p><p><a href="http://localhost:[port]/docx-html-editor-0.0.1/upload.html">http://localhost:[port]/docx-html-editor-0.0.1/upload.html</a></p><p>To test things are working properly, choose a docx file.  You should see it load in CKEditor.</p><h1><a id="_Toc371058486"></a>API</h1><p>This solution exposes an API with 2 basic functions:</p><table><tr><td rowspan="2"></td><td rowspan="2"><p><strong><em>Name</em></strong></p></td><td colspan="2"><p><strong><em>Input</em></strong></p></td><td rowspan="2"><p><strong><em>Output</em></strong></p></td><td rowspan="2"><p><strong><em>Comments</em></strong></p></td></tr><tr><td><p><strong><em>Type</em></strong></p></td><td><p><strong><em>Endpoint</em></strong></p></td></tr><tr><td><p>1</p></td><td><p>Load</p></td><td><p>POST docx using encoding type multipart/form-data, in form data param named "docxfile" </p></td><td><p>services/load</p></td><td><p>Web-editor ready XHTML</p></td><td><p>Creates session.</p><p>You can customise the XHTML which is served, by modifying docx2xhtml_CKEditor2013.xslt</p></td></tr><tr><td><p>2</p></td><td><p>Save</p></td><td><p>POST XHTML using application/x-www-form-urlencoded in form param editorOutput</p></td><td><p>services/save</p></td><td><p>Docx stream</p></td><td><p>Be sure to include session info in your request</p></td></tr></table><p><br />Supporting the load operation are various additional endpoints:</p><table><tr><td><p><strong><em>Endpoint</em></strong></p></td><td><p><strong><em>Description</em></strong></p></td></tr><tr><td><p>services/css</p></td><td><p>Get the CSS which represents the styles in the docx</p></td></tr><tr><td><p>services/image</p></td><td><p>Get an image present in the docx;<br />Upload a new image to the server</p></td></tr><tr><td><p>placeholders</p></td><td><p>Retrieve image representing “long tail” content</p></td></tr><tr><td><p>services/images</p></td><td><p>Browse images on the server</p></td></tr><tr><td><p>ckeditor</p></td><td><p>Get a CKEditor resource</p></td></tr></table><h1><a id="_Toc371058487"></a>INTEGRATION</h1><p>To integrate in your application, your application can intermediate between the client and this web application to control:</p><ul><li>Which docx file is to be loaded/edited.<br />For example, your workflow determines this, or user browses your content management system</li><li>What is done with the docx stream on services/save</li></ul><h2>Session tracking</h2><p>Session tracking is required in order for this web application to function correctly.  Symptoms of missing session info include:</p><ul><li>Images missing</li><li>No styles in editor</li><li>Unable to save the editor HTML output as a docx</li></ul><p>Our approach to session tracking is the widely used javax.servlet.http.HttpSession interface.  This approach supports session tracking by either:</p><ul><li>Cookie (typically, ‘JSESSIONID’), or</li><li>URL rewriting</li></ul><p>In some integration scenarios, URL rewriting will be preferred.  An application server may be able to be configured to force this.  For example, with Tomcat, you can set attribute cookies="false" in conf/context.xml. </p><p>The appendices (1 and 2) show request/response pairs for the case where session tracking is via a cookie called JSESSIONID. </p><h2>Load Endpoint</h2><table><tr><td rowspan="2"></td><td rowspan="2"><p><strong><em>Name</em></strong></p></td><td colspan="2"><p><strong><em>Input</em></strong></p></td><td rowspan="2"><p><strong><em>Output</em></strong></p></td><td rowspan="2"><p><strong><em>Comments</em></strong></p></td></tr><tr><td><p><strong><em>Type</em></strong></p></td><td><p><strong><em>Endpoint</em></strong></p></td></tr><tr><td><p>1</p></td><td><p>Load</p></td><td><p>POST docx using encoding type multipart/form-data, in form data param named "docxfile" </p></td><td><p>services/load</p></td><td><p>Web-editor ready XHTML</p></td><td><p>Creates session.</p><p>You can customise the XHTML which is served, by modifying docx2xhtml_CKEditor2013.xslt</p></td></tr></table><p><strong>adv=bare</strong>: There is an optional parameter ‘adv’, which, if set to ‘bare’, will return a plain XHTML rendition of the docx (ie as opposed to an XHTML file which includes ckeditor.js and CKEDITOR.config).  If you choose to use this, you will need to configure/invoke the web editor yourself.    You will also need to configure it to return suitable well-formed XHTML to the save endpoint.  See docx2xhtml_CKEditor2013.xslt for an example of a working CKEditor configuration.</p><h1><a id="_Toc371058488"></a>JAX-RS</h1><p>Docx4j Web Editor is a JAX RS 2.0 application.</p><p>It uses the Jersey implementation of JAX RS:</p><p>		&lt;dependency&gt;</p><p>			&lt;groupId&gt;org.glassfish.jersey.core&lt;/groupId&gt;</p><p>			&lt;artifactId&gt;jersey-server&lt;/artifactId&gt;</p><p>			&lt;version&gt;2.1&lt;/version&gt;</p><p>		&lt;/dependency&gt;</p><p>		&lt;dependency&gt;</p><p>			&lt;groupId&gt;org.glassfish.jersey.containers&lt;/groupId&gt;</p><p>			&lt;artifactId&gt;jersey-container-servlet-core&lt;/artifactId&gt;</p><p>			&lt;version&gt;2.1&lt;/version&gt;</p><p>		&lt;/dependency&gt;</p><h1><a id="_Toc371058489"></a>LOGGING</h1><p>Docx4j 3.0 logs using slf4j.  Unfortunately, Jersey uses java.util.logging (JUL) for logging.   You can vote to change this:</p><ul><li><a href="https://java.net/jira/browse/JERSEY-369">https://java.net/jira/browse/JERSEY-369</a></li><li><a href="https://java.net/jira/browse/JERSEY-1275">https://java.net/jira/browse/JERSEY-1275</a></li></ul><p>For consistency with Jersey, docx4j Web Editor also uses JUL.  For details on how to configure JUL, consult your application server/servlet container documentation.</p><p>To configure docx4j’s slf4j logging, you should add a binding jar (eg slf4j-log4j-1.7.5.jar) where your classloader can find it. </p><p>slf4j’s jul-to-slf4j module includes SLF4JBridgeHandler, which routes all incoming JUL records to the SLF4j API.  However, this has a performance impact, so docx4j Web Editor doesn’t use it.  For further information, please see:</p><ul><li><a href="http://www.slf4j.org/legacy.html#jul-to-slf4j">http://www.slf4j.org/legacy.html#jul-to-slf4j</a></li><li><a href="http://blog.cn-consult.dk/2009/03/bridging-javautillogging-to-slf4j.html">http://blog.cn-consult.dk/2009/03/bridging-javautillogging-to-slf4j.html</a></li></ul><h1><a id="_Toc371058490"></a>DEPLOYMENT NOTES</h1><p>[various app servers / servlet containers to be completed]</p><h1><a id="_Toc371058491"></a>KNOWN ISSUES/LIMITATIONS</h1><p>[to be completed]</p><h1><a id="_Toc371058494"></a>Appendix 1 – LOAD REQUEST/RESPONSE example</h1><h2>Request</h2><p><strong>POST</strong> /docx-html-editor-1.0.0-SNAPSHOT/<strong>services/upload</strong> HTTP/1.1</p><p>Host: localhost:8086</p><p>Connection: keep-alive</p><p>Content-Length: 13898</p><p>Cache-Control: no-cache</p><p>Pragma: no-cache</p><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</p><p>Origin: http://localhost:8086</p><p>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36</p><p><strong>Content-Type: multipart/form-data; boundary=----WebKitFormBoundarypkz1C4HemKRtrs7v</strong></p><p>Referer: http://localhost:8086/docx4j-web-editor-1.0.0-SNAPSHOT/upload.html</p><p>Accept-Encoding: gzip,deflate,sdch</p><p>Accept-Language: en-GB,en-US;q=0.8,en;q=0.6</p><p>------WebKitFormBoundarypkz1C4HemKRtrs7v</p><p>Content-Disposition: form-data; <strong>name="docxfile";</strong> filename="Hello world.docx"</p><p>Content-Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document</p><h2>Response</h2><p>HTTP/1.1 200 OK</p><p>Server: Apache-Coyote/1.1</p><p><strong>Set-Cookie: JSESSIONID=7CDDB5B0FD73F5BCC655FCD2AE949006</strong>; Path=/docx4j-web-editor-1.0.0-SNAPSHOT/</p><p>Content-Type: text/html</p><p>Content-Length: 5378</p><p>Date: Thu, 31 Oct 2013 22:31:52 GMT</p><h1><a id="_Toc371058495"></a>Appendix 2 – SAVE REQUEST/RESPONSE example</h1><h2>Request</h2><p><strong>POST</strong> /docx-html-editor-1.0.0-SNAPSHOT/<strong>services/save</strong> HTTP/1.1</p><p>Host: localhost:8086</p><p>Connection: keep-alive</p><p>Content-Length: 226</p><p>Cache-Control: no-cache</p><p>Pragma: no-cache</p><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</p><p>Origin: http://localhost:8086</p><p>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36</p><p><strong>Content-Type: application/x-www-form-urlencoded</strong></p><p>Referer: http://localhost:8086/docx4j-web-editor-1.0.0-SNAPSHOT/services/upload</p><p>Accept-Encoding: gzip,deflate,sdch</p><p>Accept-Language: en-GB,en-US;q=0.8,en;q=0.6</p><p><strong>Cookie: JSESSIONID=7CDDB5B0FD73F5BCC655FCD2AE949006</strong></p><p><strong>editorOutput</strong>=%3Cp+class%3D%22Normal+DocDefaults+%22+id%3D%22DOCX4J_EDITOR%3Ap148%22%3E%3Cspan+class%3D%22DefaultParagraphFont+%22+style%3D%22font-family%3A+Calibri%3B%22%3EHello%2C+world%21%3C%2Fspan%3E%3C%2Fp%3E&amp;submit=Submit</p><h2>Response</h2><p>HTTP/1.1 200 OK</p><p>Server: Apache-Coyote/1.1</p><p>Content-Disposition: attachment; filename=result.docx</p><p>Content-Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document</p><p>Transfer-Encoding: chunked</p><p>Date: Thu, 31 Oct 2013 22:35:51 GMT</p>